<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>ISG CTF 2014 Write-up (Out of Space, X-Area) | watch0ut Notebook</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">ISG CTF 2014 Write-up (Out of Space, X-Area)</h1><a id="logo" href="/.">watch0ut Notebook</a><p class="description">echo &quot;TXIuQ2VuZytHcmVhdFlZWCtKYWNrUGFuPXdhdGNoMHV0LCBhIHRlYW0gb2YgMyBjb21wdXRlciBnZWVrcy4&quot; | base64 -d</p></div><div id="nav-menu"><a href="/"><i class="fa icon-home"> 首页</i></a><a href="/about/"><i class="fa icon-about"> 关于</i></a><a href="/atom.xml"><i class="fa icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">ISG CTF 2014 Write-up (Out of Space, X-Area)</h1><div class="post-meta">Sep 29, 2014<span> | </span><span class="category"><a href="/categories/CTF/">CTF</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Out-of-Space"><span class="toc-number">1.</span> <span class="toc-text">Out of Space</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#X-Area"><span class="toc-number">2.</span> <span class="toc-text">X-Area</span></a></li></ol></div></div><div class="post-content"><h1 id="Out-of-Space"><a href="#Out-of-Space" class="headerlink" title="Out of Space"></a>Out of Space</h1><p>这个程序不能直接运行，我队友试了，直接死机。看了看是用C#写的，直接用.NET Reflector反编译，源码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public static void Main()</div><div class="line">&#123;</div><div class="line">    Console.WriteLine(&quot;Generating data...&quot;);</div><div class="line">    StreamWriter writer = new StreamWriter(&quot;temp.txt&quot;);</div><div class="line">    ulong num = 1L;</div><div class="line">    do</div><div class="line">    &#123;</div><div class="line">        writer.Write(&quot;ISG&quot;);</div><div class="line">        num += (ulong) 1L;</div><div class="line">    &#125;</div><div class="line">    while (num &lt;= 0xfa00000000L);</div><div class="line">    writer.Close();</div><div class="line">    Console.WriteLine(&quot;Almost done...&quot;);</div><div class="line">    SHA1CryptoServiceProvider provider = new SHA1CryptoServiceProvider();</div><div class="line">    FileStream inputStream = new FileStream(&quot;temp.txt&quot;, FileMode.Open, FileAccess.Read);</div><div class="line">    byte[] buffer = provider.ComputeHash(inputStream);</div><div class="line">    inputStream.Close();</div><div class="line">    File.Delete(&quot;temp.txt&quot;);</div><div class="line">    Console.WriteLine(&quot;ISG&#123;&quot; + BitConverter.ToString(buffer).ToLower() + &quot;&#125;&quot;);</div><div class="line">    Console.ReadKey();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>代码功能，主要就是计算<code>0xfa00000000</code>个“ISG”的<code>SHA1</code>值，所以无需写入文件，直接在内存里计算，这里直接写个Python脚本跑一下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">import hashlib</div><div class="line"></div><div class="line">part = &apos;ISG&apos; * 40</div><div class="line">sha1 = hashlib.sha1()</div><div class="line">i = 0</div><div class="line">while i &lt; 0xfa00000000:</div><div class="line">	sha1.update(part)</div><div class="line">	if i % 10000000000 == 0:</div><div class="line">		print str(i) + &apos;: &apos; + sha1.hexdigest()</div><div class="line">	i += 40</div><div class="line">print &apos;ISG&#123;&apos; + sha1.hexdigest() + &apos;&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>当时失误，一次计算的数据量有点小，导致计算了将近6个小时，最后得到结果：<code>ISG{86386ac8da052d2dc694218affa57b920d02583b}</code><br>。直接提交，结果不对，我又去翻了翻SHA1的原理，发现这么计算没问题，后来让队友在C#下试了试，发现Bitonvert会在每个字节间加“-“，最后加上：<code>ISG{86-38-6a-c8-da-05-2d-2d-c6-94-21-8a-ff-a5-7b-92-0d-02-58-3b}</code>。</p>
<h1 id="X-Area"><a href="#X-Area" class="headerlink" title="X-Area"></a>X-Area</h1><p>首先，有登录框，一顿尝试未果，取消后给了个邮箱，一开始不知道有啥用，后来想到泄漏的500万Gmail帐号，在其中一搜，果真有，用搜到的密码登录，得到如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?php</div><div class="line">/*</div><div class="line">I found a piece of hash from an old basic auth file.</div><div class="line">0ops:$apr1$XZ6oHreE$rYRGk9cFLxm1hF4TAc0m50</div><div class="line">That may be helpful.</div><div class="line">It is said that in the password nums and Lowercase letter only.</div><div class="line">Good luck!</div><div class="line">*/</div><div class="line">$valid_passwords = array (&quot;hack.the.life@gmail.com&quot; =&gt; &quot;zasada&quot;);</div><div class="line">$valid_users = array_keys($valid_passwords);</div><div class="line"></div><div class="line">$user = @$_SERVER[&apos;PHP_AUTH_USER&apos;];</div><div class="line">$pass = @$_SERVER[&apos;PHP_AUTH_PW&apos;];</div><div class="line"></div><div class="line">$validated = (in_array($user, $valid_users)) &amp;&amp; ($pass == $valid_passwords[$user]);</div><div class="line"></div><div class="line">if (!$validated) &#123;</div><div class="line">  header(&apos;WWW-Authenticate: Basic realm=&quot;X-Area&quot;&apos;);</div><div class="line">  header(&apos;HTTP/1.0 401 Unauthorized&apos;);</div><div class="line">  die (&quot;I don&apos;t think you are &apos;hack.the.life@gmail.com&apos;. Get out!&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">eval(base64_decode(&apos;ZXJyb3JfcmVwb3J0aW5nKDApOwpzZXRfdGltZV9saW1pdCgwKTsKCmZ1bmN0aW9uIGRlY3J5cHQoJGVuY3J5cHRlZCwgJGtleSkKewoJJGtleT1tZDUoJGtleSk7CiAgICAkY2lwaGVydGV4dF9kZWMgPSBwYWNrKCJIKiIsJGVuY3J5cHRlZCk7CiAgICAkbW9kdWxlID0gbWNyeXB0X21vZHVsZV9vcGVuKE1DUllQVF9SSUpOREFFTF8xMjgsICcnLCBNQ1JZUFRfTU9ERV9DQkMsICcnKTsKICAgICRpdiA9IHN1YnN0cihtZDUoJGtleSksMCxtY3J5cHRfZW5jX2dldF9pdl9zaXplKCRtb2R1bGUpKTsKICAgIG1jcnlwdF9nZW5lcmljX2luaXQoJG1vZHVsZSwgJGtleSwgJGl2KTsKICAgICRkZWNyeXB0ZWQgPSBtZGVjcnlwdF9nZW5lcmljKCRtb2R1bGUsICRjaXBoZXJ0ZXh0X2RlYyk7CiAgICBtY3J5cHRfZ2VuZXJpY19kZWluaXQoJG1vZHVsZSk7CiAgICBtY3J5cHRfbW9kdWxlX2Nsb3NlKCRtb2R1bGUpOwogICAgcmV0dXJuIHJ0cmltKCRkZWNyeXB0ZWQsIlwwIik7Cn0KCmlmKEAkX1JFUVVFU1RbJ2tleSddKXsKCSRrZXk9JF9SRVFVRVNUWydrZXknXTsKCWVjaG8gZXZhbCh+J5qcl5Dfmomek9ebmpyNho+L193OyJ2bzZyanp2am8zKns7Pz5mZnJuZyp2bm8bPzpmems7OxsrHypzJncrLyc7Nm8bHz8vMy8jKns6ZxpqdnJvGxsvPx86ZnJ7NnczLx57JzsvMz8jLycrKyprInM2dyMjKzJnPzcadysedz87IxpydzZvOzsidnc/Kmc7My5zNm57NmcnPxp3OzMzMys7OmZzIyMidmZ3PxpzNnMycx8uczZqdxpmcms/Mzp3Gxs7LyczJxpucmc2emsfNy8nJx8mby5qezJmbzcbOycidyciczMzPzMqdncuezcjKmsaanJ3IzsaczMidyc+Zyp2azZnNzZzJxpyazcvGyciam5zOncrGyJ7NxsedmZnGz8qbmZqamsbInsyezciZnpnIxp3Myp7HzMrHx8jPz5mdz8/Kz8vOnJqans3HyJuamcvHnsiemZmdx8zOx52dm8bHmsadnZ2ezcbJm52Zm57Gm8/O3dPf25SahtbWxCcpOwp9ZWxzZXsKCWVjaG8gIkFjY2VzcyBERU5JRUQhIjsKfQ==&apos;));</div><div class="line">echo &apos;&lt;!-- &apos;;echo file_get_contents(__FILE__);?&gt;</div></pre></td></tr></table></figure></p>
<p>可以看到，注释中有个帐号：<code>0ops:$apr1$XZ6oHreE$rYRGk9cFLxm1hF4TAc0m50</code>，用<code>John the Ripper</code>解密得到密码：<code>5s41t</code>。还有一段base64编码的，解码得到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">error_reporting(0);</div><div class="line">set_time_limit(0);</div><div class="line"></div><div class="line">function decrypt($encrypted, $key)</div><div class="line">&#123;</div><div class="line">    $key=md5($key);</div><div class="line">    $ciphertext_dec = pack(&quot;H*&quot;,$encrypted);</div><div class="line">    $module = mcrypt_module_open(MCRYPT_RIJNDAEL_128, &apos;&apos;, MCRYPT_MODE_CBC, &apos;&apos;);</div><div class="line">    $iv = substr(md5($key),0,mcrypt_enc_get_iv_size($module));</div><div class="line">    mcrypt_generic_init($module, $key, $iv);</div><div class="line">    $decrypted = mdecrypt_generic($module, $ciphertext_dec);</div><div class="line">    mcrypt_generic_deinit($module);</div><div class="line">    mcrypt_module_close($module);</div><div class="line">    return rtrim($decrypted,&quot;\0&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">if(@$_REQUEST[&apos;key&apos;])&#123;</div><div class="line">    $key=$_REQUEST[&apos;key&apos;];</div><div class="line">    echo eval(~&apos;ß××ÝÎÈÍÌÊÎÏÏÊÆÏÎÎÎÆÊÇÊÉÊËÉÎÍÆÇÏËÌËÈÊÎÆÆÆËÏÇÎÍÌËÇÉÎËÌÏÈËÉÊÊÊÈÍÈÈÊÌÏÍÆÊÇÏÎÈÆÍÎÎÈÏÊÎÌËÍÍÉÏÆÎÌÌÌÊÎÎÈÈÈÏÆÍÌÇËÍÆÏÌÎÆÆÎËÉÌÉÆÍÇÍËÉÉÇÉËÌÍÆÎÉÈÉÈÌÌÏÌÊËÍÈÊÆÈÎÆÌÈÉÏÊÍÍÍÉÆÍËÆÉÈÎÊÆÈÍÆÇÆÏÊÆÈÌÍÈÈÆÌÊÇÌÊÇÇÈÏÏÏÏÊÏËÎÍÇÈËÇÈÇÌÎÇÆÇÆÍÆÉÆÏÎÝÓßÛÖÖÄ&apos;);</div><div class="line">&#125;else&#123;</div><div class="line">    echo &quot;Access DENIED!&quot;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>eval的参数是将一个字符串取反，直接取反得到结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">decrypt(&quot;17bd2ceabed35a100ffcdf5bdd901fae119585c6b54612d98043475a1f9ebcd994081fca2b348a61430746555e7c2b7753f029b58b0179cb2d117bb05f134c2da2f609b1333511fc777bfb09c2c3c84c2eb9fce031b99146369dcf2ae8246686d4ea3fd29167b67c33035bb4a275e9ecb719c37b60f5be2f22c69ce24967edc1b597a298bff905dfeee97a3a27faf79b35a83588700fb005041ceea287def48a7affb8318bbd98e9bbba296dbfda9d01&quot;, $key));</div></pre></td></tr></table></figure></p>
<p>把这段代码和decrypt函数放在一起，然后执行得到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ob_start(); //the flag is ISG&#123;tHe_MaGic_pHP_S0UrCE_c0D3&#125; echo &quot; Just get the flag!!&quot;; $info = ob_get_contents(); ob_end_clean(); echo &quot;Hello Hackers!&quot;; return $info;</div></pre></td></tr></table></figure></p>
<p>得到flag：<code>ISG{tHe_MaGic_pHP_S0UrCE_c0D3}</code>。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://blog.watch0ut.com/2014/09/29/ISG-CTF-2014-Write-up-Out-of-Space-X-Area/" data-id="ciyjsu782000df4mphkodw4w7" class="article-share-link">分享到</a><div class="tags"><a href="/tags/CTF/">CTF</a></div><div class="post-nav"><a href="/2014/09/29/ISG-CTF-2014-Write-up-SQLMAP-Up-to-Date/" class="pre">ISG CTF 2014 Write-up (SQLMAP, Up-to-Date)</a><a href="/2014/09/29/ISG-CTF-2014-Write-up-Smile-Chopper-Cryptobaby-GIF/" class="next">ISG CTF 2014 Write-up (Smile, Chopper, Cryptobaby, GIF)</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://blog.watch0ut.com"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CTF/">CTF</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/CTF/" style="font-size: 15px;">CTF</a> <a href="/tags/Web/" style="font-size: 15px;">Web</a> <a href="/tags/Misc/" style="font-size: 15px;">Misc</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2015/12/08/HCTF-2015-Write-ups/">HCTF 2015 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/11/29/9447-CTF-2015-Write-ups/">9447 CTF 2015 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/10/HCTF-2014-Write-ups/">HCTF 2014 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/10/08/XD-CTF-2014-Write-ups/">XD CTF 2014 Write-ups</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/29/ISG-CTF-2014-Write-up-SQLMAP-Up-to-Date/">ISG CTF 2014 Write-up (SQLMAP, Up-to-Date)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/29/ISG-CTF-2014-Write-up-Out-of-Space-X-Area/">ISG CTF 2014 Write-up (Out of Space, X-Area)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/09/29/ISG-CTF-2014-Write-up-Smile-Chopper-Cryptobaby-GIF/">ISG CTF 2014 Write-up (Smile, Chopper, Cryptobaby, GIF)</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/26/HITCON-CTF-2014-Tarmful-Write-up/">HITCON CTF 2014 Tarmful Write-up</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/22/HITCON-CTF-2014-DIAGCGI-Write-up/">HITCON CTF 2014 DIAGCGI Write-up</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/08/20/HITCON-CTF-2014-PY4H4SHER-Write-up/">HITCON CTF 2014 PY4H4SHER Write-up</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">watch0ut Notebook.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>